{"name":"Allocate Character","type":"script","author":"id6kMyBVD3NnFdod","img":"icons/creatures/eyes/human-single-blue.webp","scope":"global","command":"let actor = token?.actor;\nlet options = \"\";\nif (!actor) return ui.notifications.error(\"Please select a token first.\");\nif (actor.isToken) return ui.notifications.error(\"The token must have Actor Link ON to be assigned to a user.\");\ngame.users.forEach(user => {\n    options += `<option value = \"${user.id}\">${user.name}</option>`\n})\n\nlet user_id= await new Promise(resolve => {\n            new Dialog({\n                title: \"Pick a User\",\n                content: `<p/><div align=\"center\"><select id=\"get_user\">${options}</select></div>`,\n                buttons: {\n                    ok: {\n                        label: \"OK\",\n                        callback: () => {\n                            resolve(document.getElementById(\"get_user\").value)\n                        }\n                    }\n                },\n                default:\"ok\"\n            }).render(true);\n        });\n\n        let user = game.users.get(user_id);\n\n        // Give the user owner permissions for the selected character\n        await actor.update({\"permission\":{[user.id]:3}})\n        \n        // Reset their permissions to default for their previous character\n                if (user.character) {\n                    let permissions = user.character.data.permission\nconsole.log(permissions)\n                    let newPermissions = {};\n                    for (let permission in permissions){\n                        console.log(permission);\n                        console.log(user.id);\n                        if (permission != user.id) newPermissions[permission] = permissions[permission];\n                    }\nconsole.log(newPermissions)\n                    await user.character.update({permission:newPermissions},{diff:false, recursive:false, render:true, noHook:true});\n                }\n        \n        // Assign the character to the user.\n        await user.update({ character : actor.id });","folder":null,"sort":0,"permission":{"default":0,"id6kMyBVD3NnFdod":3},"flags":{"core":{"sourceId":"Macro.ndIWMDfABqI7nTu0"}},"_id":"3rIISB1ysvBlB77Z"}
{"name":"Create an Ad-Hoc Zone (0.8)","type":"script","author":"id6kMyBVD3NnFdod","img":"icons/sundries/scrolls/scroll-yellow-teal.webp","scope":"global","command":"let text= await new Promise(resolve => {\n            new Dialog({\n                title: \"Pick a Zone Name\",\n                content: '<p/><div align=\"center\"><input id=\"dialog_box\" style=\"width:375px\" autofocus></input></div>',\n                buttons: {\n                    ok: {\n                        label: \"OK\",\n                        callback: () => {\n                            resolve(document.getElementById(\"dialog_box\").value)\n                        }\n                    }\n                },\n                default:\"ok\"\n            }).render(true);\n        });\n\nDrawingDocument.create({\n                type: CONST.DRAWING_TYPES.RECTANGLE,\n                author: game.user.id,\n                x: canvas.stage.pivot._x,\n                y: canvas.stage.pivot._y,\n                width: 500,\n                height: 350,\n                text: text,\n                fillType: CONST.DRAWING_FILL_TYPES.SOLID,\n                fillColor: \"#FFFFFF\",\n                fillAlpha: 1,\n                strokeWidth: 4,\n                strokeColor: \"#000000\",\n                strokeAlpha: 1,\n                fontFamily: \"Modesto Condensed\",\n                fontSize: 48,\n                textColor: \"#000000\",\n                align:\"left\",\n                points: []\n            }, {parent: game.scenes.viewed});","folder":null,"sort":0,"permission":{"default":0,"id6kMyBVD3NnFdod":3},"flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.ohyUa2aEAt90Xw7f"}},"_id":"4kvNWONhUr8JZb5n"}
{"name":"Roll a track","type":"script","author":"DZPKcD9vey4gz8ew","img":"icons/sundries/gaming/dice-pair-white-green.webp","scope":"global","command":"let tracks;\nif (!token) {\n    ui.notifications.info(\"Please select a token first\");\n    return;\n}\nif (!token.actor.isOwner){\n    ui.notifications.info(\"You don't own that token.\");\n    return;\n}\ntracks = duplicate(token.actor.data.data.tracks);\nlet rollableTracks = [];\n\nfor (let t in tracks){\n   let track = tracks[t];\n   let r = 0;\n   if (track.boxes > 0){\n      for (let box of track.box_values){ \n         if (!box) r++;\n      }\n      let output = {name:track.name, boxes:r};\n      rollableTracks.push(output);\n   }\n}\n\nlet options = \"\";\nfor (let i = 0; i < rollableTracks.length; i++){\n   options += `<option value=\"${i}\">${rollableTracks[i].name} (+${rollableTracks[i].boxes})</option>}`\n}\n\nlet content = `<h2>Pick a track to roll for ${token.actor.name}<h2><select class=\"fco_roll_a_track\">${options}</select>`;\nlet width = 400;\nlet height = 180;\n\nnew Dialog({\n            title: `Roll a track`,\n            content: content,\n            buttons: {\n                ok: {\n                    label: game.i18n.localize(\"fate-core-official.OK\"),\n                    callback: async ()=> {\n                       // Do the stuff here\n                       let index = $('.fco_roll_a_track')[0].value;\n                       let track = rollableTracks[index];\n                       let boxes = track.boxes;\n                       let name = track.name;\n\n                       let r = new Roll(`4dF + ${boxes}`);\n                       let roll = await r.roll();\n                       roll.dice[0].options.sfx = {id:\"fate4df\",result:roll.result};\n                       let msg = ChatMessage.getSpeaker(token.actor)\n                       msg.alias = token.actor.name;\n    \n                       roll.toMessage({\n                         flavor: `<h1>${name}</h1>${game.i18n.localize(\"fate-core-official.RolledBy\")}: ${game.user.name}<br>\n                         Unmarked boxes: ${boxes} <br>`,\n                         speaker: msg\n                       });\n                    }\n                    }\n                }\n        },\n        {\n            width:width,\n            height:height,\n        }).render(true);","folder":null,"sort":0,"permission":{"default":0,"DZPKcD9vey4gz8ew":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.ZFoQVITGNtYVdMAg"}},"_id":"BoscHg1qH0NiqJuO"}
{"name":"Speak As...","type":"script","author":"ENZTLNKeIfA9Jnom","img":"icons/magic/sonic/scream-wail-shout-teal.webp","scope":"global","command":"let selectText = \"\";\ngame.actors.contents.forEach(actor => {\n    if (actor.type== \"fate-core-official\") selectText += `<option value = \"${actor.id}\">${actor.name}</option>`\n})\n            new Dialog({\n                title: \"Speak As...\",\n                content: `<div align = \"center\" style =\"padding:25px\"><select id=\"spad_name\" style=\"width:350px\" autofocus>\n                          ${selectText} \n                          </select>\n                              <div align=\"left\" contenteditable = \"true\"; style=\"padding:5px; overflow-y:auto; margin-top:10px; width: 350px; height:120px; background-color:white; border:2px black solid\" id=\"spad_text\"></div>\n                          </div>`,\n                buttons: {\n                    ok: {\n                        label: \"OK\",\n                        callback: () => {\n                             let content = $('#spad_text')[0].innerHTML;\n                             let actor = game.actors.get($('#spad_name')[0].value);\n                             ChatMessage.create({content: content, speaker : {actor}, type: CONST.CHAT_MESSAGE_TYPES.IC })\n                        }\n                    }\n                }\n            }).render(true);","folder":null,"sort":0,"permission":{"default":0,"ENZTLNKeIfA9Jnom":3},"flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.c6tMgB66lCfn4Wt3"}},"_id":"UPf3gd6MXJEAUiJD"}
{"name":"Create an Ad-Hoc Zone (0.8 transparent)","type":"script","author":"DZPKcD9vey4gz8ew","img":"Icons/treasure-map.svg","scope":"global","command":"let text= await new Promise(resolve => {\n            new Dialog({\n                title: \"Pick a Zone Name\",\n                content: '<p/><div align=\"center\"><input id=\"dialog_box\" style=\"width:375px\" autofocus></input></div>',\n                buttons: {\n                    ok: {\n                        label: \"OK\",\n                        callback: () => {\n                            resolve(document.getElementById(\"dialog_box\").value)\n                        }\n                    }\n                },\n                default:\"ok\"\n            }).render(true);\n        });\nlet d = await DrawingDocument.create({\n                type: CONST.DRAWING_TYPES.RECTANGLE,\n                author: game.user.id,\n                x: canvas.stage.pivot._x,\n                y: canvas.stage.pivot._y,\n                width: 500,\n                height: 350,\n                text: text,\n                fillType: CONST.DRAWING_FILL_TYPES.NONE,\n                fillColor: \"#FFFFFF\",\n                fillAlpha: 0,\n                strokeWidth: 4,\n                strokeColor: \"#80ff95\",\n                strokeAlpha: 1,\n                fontFamily: \"Modesto Condensed\",\n                fontSize: 48,\n                textColor: \"#000000\",\n                align:\"left\",\n                points: []\n            }, {parent: game.scenes.viewed});\n\nlet dr = game.canvas.scene.drawings.find(doc => doc.id == d.id);\nlet btd = {textAlignment: \"left\", textStrokeWidth: 5, textStrokeColor: \"#ffffff\"};\nawait game.scenes.viewed.updateEmbeddedDocuments(\"Drawing\",[{\"_id\":dr.id, \"flags.better-text-drawings\":btd}])","flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.ohyUa2aEAt90Xw7f"}},"ownership":{"default":0,"DZPKcD9vey4gz8ew":3},"_stats":{"systemId":"fate-core-official","systemVersion":"4.4.07","coreVersion":"10.272","createdTime":1656635377486,"modifiedTime":1656635377486,"lastModifiedBy":"DZPKcD9vey4gz8ew"},"folder":null,"sort":0,"_id":"n0ziEfGTtw8jCdWf"}
